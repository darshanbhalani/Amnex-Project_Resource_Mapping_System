@model List<Department>;

@section style {
    <style>

        #assign .dt-column-order {
            display: none;
        }

        .asd {
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
        }

        .page-link {
            color: black;
        }

        #example th {
            text-align: center;
        }

        .page-item.active .page-link {
            background-color: black;
            border: 1px solid black;
        }
    </style>
}


<h3>Departments</h3>

<table id="example" class="table table-striped table-bordered" style="width:100%">
    <thead>
        <tr class="bg-dark">
            <th class="text-white">Id</th>
            <th class="text-white">Name</th>
            <th class="text-white">Update</th>
            <th class="text-white">Delete</th>

        </tr>
    </thead>
    <tbody id="dataRows">
        @foreach (var department in Model)
        {
            <tr>
                <td style="text-align: center;">@department.DepartmentId</td>
                <td id="deptname" style="text-align: left;">@department.DepartmentName</td>
                <td style="text-align: center;">
                    <i class="fa fa-pencil-square-o editbtn me-5" aria-hidden="true"></i>
                </td>
                <td style="text-align: center;">
                    <i class="fa fa-solid fa-trash delbtn"></i>
                </td>
            </tr>
        }
    </tbody>
</table>



@section Scripts {
    <script>
        var addButtonAppend = false;

        $(document).ready(function () {

            new DataTable('#example');
            $('#dt-search-0').css({ 'width': '30rem' })
            $('#dt-search-0').addClass('flex-row-reverse')
            document.getElementById('dt-search-0').placeholder = 'Search Skills';
            $('.dt-search label').remove();
            if (!addButtonAppend) {
                var addButton = $('<button>').text('Add');
                $('.dt-search').append(addButton);

                addButton.click(function () {
                    $("#departmentModal").modal('show');
                })
                addButtonAppend = true;
            }

            $('.dt-search button').addClass('btn btn-dark');
            $('#dt-search-0').parent().addClass('d-flex flex-row-reverse');
            $('#dt-search-0').parent().parent().parent().addClass('d-flex flex-row-reverse');
            $('#dt-length-0').parent().parent().removeClass('me-auto');
            $('#dt-search-0').parent().parent().removeClass('ms-auto');

            //Edit Department
            $(document).on("click", ".editbtn", function () {
                var departmentid = $(this).closest("tr").find('td:eq(0)').text();
                var department = $(this).closest("tr").find('td:eq(1)').text();

                $("#editDepartment").val(department);

                $("#editDepartmentModal").modal('show');

                $("#editDepartment").on("input", function () {
                    var newDepartment = $(this).val();

                    if (newDepartment !== department) {
                        $("#EditChangesBtn").removeAttr("disabled");
                        $("#EditChangesBtn").addClass('btn-success');
                    } else {
                        $("#EditChangesBtn").attr("disabled", true);
                        $("#EditChangesBtn").removeClass('btn-success');
                    }
                });

                $(document).on("click", "#EditChangesBtn", function () {
                    var editeddepartmentName = $("#editDepartment").val();
                    var data = {
                        DepartmentId: departmentid,
                        DepartmentName: editeddepartmentName,
                    };
                    $.ajax({
                        type: "PUT",
                        url: "/Departments/UpdateDepartment",
                        data: data,
                        success: function (result) {
                            $('#editDepartmentModal').modal('hide');
                            location.reload();
                        },
                        error: function (xhr, status, error) {
                            console.error(error);
                        }
                    });
                });
            });


            // Add Department
            $("#addsaveChangesBtn").click(function () {
                var departmentName = $("#department").val();
                var data = {
                    DepartmentName: departmentName,
                };
                $.ajax({
                    type: "POST",
                    url: "/Departments/AddDepartment",
                    data: data,
                    success: function (result) {
                        if (result.success) {
                            alert(departmentName + " added");
                            $('#departmentModal').modal('hide');
                            location.reload();
                        }
                        else {
                            alert("Department already exists");

                        }
                    },
                    error: function (xhr, status, error) {
                        alert("Department already exists-->Error");
                        $("#department").val('');


                    }
                });
            });

            //Delete Department
            $(document).on("click", ".delbtn", function () {
                var $row = $(this).closest('tr');
                var department = $(this).closest("tr").find('td:eq(1)').text();
                var departmentid = $(this).closest("tr").find('td:eq(0)').text();
                $("#departmentNamePlaceholder").text(department);
                $("#deleteDepartmentconfirm").val('');
                $("#deleteDepartmentModal").modal('show');
                $("#deleteDepartmentconfirm").on("input", function () {
                    var newDepartment = $(this).val();

                    if (newDepartment === 'CONFIRM') {
                        $("#deleteBtn").removeAttr("disabled");
                        $("#deleteBtn").addClass('btn-danger');
                        $("#deleteBtn").click(function () {
                            var data = {
                                DepartmentId: departmentid,
                            };
                            $.ajax({
                                type: "POST",
                                url: "/Departments/DeleteDepartment",
                                data: data,
                                success: function (result) {
                                    $('#deleteDepartmentModal').modal('hide');
                                    $row.remove();
                                },
                                error: function (xhr, status, error) {
                                    console.error(errorMessage); 
                                }
                            });
                        });


                    } else {
                        $("#deleteBtn").attr("disabled", true);
                        $("#deleteBtn").removeClass('btn-danger');
                    }
                });
            });

            //Close Modals
            $("#delclosedModal, #closedModal").click(function () {
                $(".modal").modal('hide');
            });

        });
    </script>
}


@* add-modal *@
<div class="modal fade" id="departmentModal" tabindex="-1" aria-labelledby="departmentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="departmentModalLabel">Add Department</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="department">Department</label>
                        <input type="text" class="form-control" id="department" placeholder="Enter department">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="addsaveChangesBtn">Save changes</button>
            </div>
        </div>
    </div>
</div>


@* edit-modal *@
<div class="modal fade" id="editDepartmentModal" tabindex="-1" aria-labelledby="editDepartmentModalLabel" aria-hidden="true">
    <div class="modal-dialog  modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editDepartmentModalLabel">Edit Department</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="editDepartment">Department</label>
                        <input type="text" class="form-control" id="editDepartment" placeholder="Enter department">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="EditChangesBtn" disabled>Save changes</button>
            </div>
        </div>
    </div>
</div>

@* delete-modal *@
<div class="modal fade" id="deleteDepartmentModal" tabindex="-1" aria-labelledby="deleteDepartmentModalLabel" aria-hidden="true">
    <div class="modal-dialog  modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteDepartmentModalLabel">Delete Department</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="deleteDepartment">Are you sure you want to delete <b><span id="departmentNamePlaceholder"></span>?</b></label>
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-control" id="deleteDepartmentconfirm" placeholder="Type CONFIRM">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="deleteBtn" disabled>Delete</button>
            </div>
        </div>
    </div>
</div>

