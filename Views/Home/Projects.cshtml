@* datatables *@


@model temp;


<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/2.0.3/css/dataTables.bootstrap5.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bbbootstrap/libraries@main/choices.min.css">
<script src="https://cdn.jsdelivr.net/gh/bbbootstrap/libraries@main/choices.min.js"></script>


<style>
    #example th {
        text-align: center;
    }

    #example td {
        text-align: center;
    }


    #example tbody tr td:first-child {
        width: 100px; /* Adjust the width as needed */
    }



    .mt-100 {
        margin-top: 100px
    }

    .select {
        color: #514B64;
    }

    .box {
        min-height: 140px;
        height: 20vh;
        max-height: 200px;
        max-width: 320px;
        width: 20vw;
        min-width: 250px;
    }

    .box {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

        .box i {
            color: #009cff;
        }

        .box:hover, .box:hover h4, .box:hover i {
            background-color: #009cff !important;
            color: aliceblue !important;
        }

    .flex-center {
        display: flex;
        justify-content: space-evenly;
        align-items: center;
        text-align: center;
    }

    #assign .dt-column-order {
        display: none;
    }

    .asd {
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
    }

    .custom-btn {
        width: 80px; /* Adjust the width as needed */
    }
</style>


@* Cards *@
<div class="container-fluid pt-4 px-4">
    <div class="row g-4 flex-center">
        <div class="col-sm-6 col-xl-3 px-4">
            <div class="bg-light rounded d-flex align-items-center justify-content-between p-4 box">
                <i class="fa fa-chart-line fa-3x"></i>
                <div class="ms-3">
                    <p class="mb-2">Total Projects</p>
                    <h4 class="mb-0">350</h4>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-xl-3 px-4">
            <div class="bg-light rounded d-flex align-items-center justify-content-between p-4 box">
                <i class="fa fa-chart-bar fa-3x"></i>
                <div class="ms-3">
                    <p class="mb-2">Total Employees</p>
                    <h4 class="mb-0">750</h4>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-xl-3 px-4">
            <div class="bg-light rounded d-flex align-items-center justify-content-between p-4 box">
                <i class="fa fa-chart-area fa-3x"></i>
                <div class="ms-3">
                    <p class="mb-2">Today Departments</p>
                    <h4 class="mb-0">8</h4>
                </div>
            </div>
        </div>

    </div>
</div>



@* Table Start *@
<div class="pt-4 table-responsive">
    <table id="example" class="table table-striped table-bordered " style="width:100%">
        <thead>
            <tr class="bg-dark">
                <th class="text-white">ProjectId</th>
                <th class="text-white">ProjectName</th>
                <th class="text-white">Status</th>
                <th class="text-white" style="width: 10px;">Actions</th>
            </tr>
        </thead>
        <tbody id="dataRows ">

            @foreach (var project in Model.project)
            {
            <tr class="row123">
                <td>@project.projectId</td>
                <td>@project.projectName</td>
                <td>@project.status</td>
                <td>
                    <i class="fa fa-edit fa-lg edit-icon pe-5 editbtn" style="cursor:pointer;" aria-hidden="true" data-toggle="modal" data-target="#EditModal"></i>
                    <i class="fa fa-trash fa-lg delete-icon delbtn" style="cursor:pointer;" aria-hidden="true" data-toggle="modal" data-target="#deleteModal" onclick="Delete(@project.projectId)"></i>
                </td>
            </tr>
            }

        </tbody>

    </table>




    <!-- Add Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Project Details</h5>
                    <button type="button" id="close" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3 ">
                            <label for="recipient-name" class="col-form-label">Project Name:</label>
                            <input type="text" class="form-control" id="Project_Name">
                        </div>

                        <div class="row">
                            <div class="col-md-6 pt-1">
                                <label for="start_date" class="form-label">Start Date:</label>
                                <input type="date" class="form-control" id="start_date" name="start_date">
                            </div>
                            <div class="col-md-6 pt-1">
                                <label for="end_date" class="form-label">End Date:</label>
                                <input type="date" class="form-control" id="end_date" name="end_date">
                            </div>
                        </div>

                        <div class="row d-flex align-items-center justify-content-center pt-4 select">
                            <div class="col-auto ps-2">
                                <label for="choices-multiple-remove-button">Department:</label>
                            </div>
                            <div class="col">

                                <select id="single" class="form-select" placeholder="Select Department">
                                    @foreach (var item in Model.list2)
                                    {
                                    <option value="@item[0]">@item[1]</option>
                                    }
                                </select>

                            </div>
                        </div>


                        <div class="row d-flex align-items-center justify-content-center pt-4 select">
                            <div class="col-auto ps-2">
                                <label for="choices-multiple-remove-button">Skills:</label>
                            </div>
                            <div class="col">

                                <select id="choices-multiple-remove-button" class="form-select " placeholder="Select skills" multiple>
                                    @foreach (var item in Model.list)
                                    {
                                    <option value="@item[0]">@item[1]</option>
                                    }
                                </select>

                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" id="close1" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="addBtn">Add</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Add Modal close -->
    <!-- Filter Modal -->
    <div class="modal fade" id="filterModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Filter</h5>
                    <button type="button" id="close" class="btn-close" data-dismiss="modal" aria-label="Close"></button>

                </div>
                <div class="modal-body">
                    <!-- First row: Dropdown for department -->
                    <div class="form-group">
                        <label for="departmentSelect">Department:</label>
                        <select class="form-control" id="departmentSelect">
                            <option value="">Select Department</option>
                            <option value="dept1">Mobility</option>
                            <option value="dept2">Integrated</option>
                            <option value="dept3">Agriculture</option>
                            <option value="dept4">Research and Development</option>
                        </select>

                    </div>

                    <!-- Second row: Dropdown for status -->
                    <div class="form-group">
                        <label for="statusSelect">Status:</label>
                        <select class="form-control" id="statusSelect">
                            <option value="">Select Status</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>

                    <!-- Third row: Date inputs for start and end date -->
                    <div class="form-group">
                        <label for="startDate">Start Date:</label>
                        <input type="date" class="form-control" id="startDate">
                    </div>
                    <div class="form-group">
                        <label for="endDate">End Date:</label>
                        <input type="date" class="form-control" id="endDate">
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" id="fclose1" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Apply</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Filter Modal close-->
    @* delete-modal *@
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog modal modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="updateModalLabel">Confirm Deletion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this item?</p>
                    <input type="text" id="confirmInput" class="form-control" placeholder="Type 'CONFIRM' to proceed">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="deleteButton" onclick=" Delete();" disabled>Delete</button>
                </div>
            </div>
        </div>
    </div>
    @* delete-modal close *@


    <!-- Edit Modal -->
    <div class="modal fade" id="Editmodal" tabindex="-1" role="dialog" aria-labelledby="EditModalLabel" aria-hidden="true">
        <div class="modal-dialog modal modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="EditModalLabel">Edit Project</h5>
                    <button type="button" id="close" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Form fields for editing project -->
                    <form id="editProjectForm">
                        <div class="form-group">
                            <label for="projectId">Project ID:</label>
                            <input type="text" class="form-control" id="projectId" name="projectId" readonly>
                        </div>
                        <div class="form-group">
                            <label for="projectName">Project Name:</label>
                            <input type="text" class="form-control" id="projectName" name="projectName">
                        </div>
                        <div class="form-group">
                            <label for="status">Status:</label>
                            <select class="form-control" id="statusSelect1">

                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="Pending">Pending</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="startDate">Start Date:</label>
                            <input type="date" class="form-control" id="startDate1" name="startDate">
                        </div>
                        <div class="form-group">
                            <label for="endDate">End Date:</label>
                            <input type="date" class="form-control" id="endDate1" name="endDate">
                        </div>

                        <div class="col-auto ps-2">
                            <label for="choices-multiple-remove-button">Skills:</label>
                        </div>
                        <div class="col">

                            <select id="choices-multiple-remove-button" class="form-select add" placeholder="Select skills" multiple>
                                @foreach (var item in Model.list)
                                {
                                <option value="@item[0]">@item[1]</option>
                                }
                            </select>

                        </div>
                        <div class="col-auto ps-2">
                            <label for="single">Department:</label>
                        </div>
                        <div class="col">

                            <select id="single2" class="form-select" placeholder="Select department">
                                @foreach (var item in Model.list2)
                                {
                                <option value="@item[0]">@item[1]</option>
                                }
                            </select>


                        </div>
                        <div class="modal-footer">
                            <button type="submit" id="editbutton" class="btn btn-primary align-items-end">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Edit Modal close -->

</div>
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/2.0.3/js/dataTables.js"></script>
<script src="https://cdn.datatables.net/2.0.3/js/dataTables.bootstrap5.js"></script>
<script>

    $(document).ready(function () {


        new DataTable('#example');


        //Add button
        var AddButton = $('<button>', {
            class: 'btn btn-primary custom-btn Add',
            text: 'Add Project',
            style: 'margin:0; width:auto;'

        });

        //Filterbutton
        var FilterButton = $('<button>', {
            class: 'btn btn-danger custom-btn filter',
            text: 'Filter',
            style: 'margin-left:1rem;'
        });

        //filter modal show
        $('#modalfilter').click(function () {
            $('#filterModal').modal('show');
        });

        FilterButton.click(function () {

            $('#filterModal').modal('show');
        });


        //Add modal show
        AddButton.click(function () {

            $('#exampleModal').modal('show');
            $('#choices-multiple-remove-button').empty();

        });


        //multiple select
        var multipleCancelButton = new Choices('#choices-multiple-remove-button', {
            removeItemButton: true,

        });



        //close Modal
        $('#close').click(function () {
            $('#deleteModal').modal('hide');
            $('#Editmodal').modal('hide');
            $('#exampleModal').modal('hide');
            $('#filterModal').modal('hide');

        });


        $('#example tbody').on('draw.dt', function () {
            $('#example tbody tr').each(function () {
                $(this).find('td:last-child').css('text-align', 'center');
            });
        });

        document.getElementById('dt-search-0').placeholder = 'Search something';
        $('label[for="dt-search-0"]').remove();
        $('#dt-search-0').parent().parent().removeClass('ms-auto');
        $('#dt-search-0').css({ 'width': '30rem', 'border': '1px solid black' });


        $('.dt-search').parent().parent().addClass('d-flex flex-row-reverse');
        $('#dt-length-0').parent().parent().removeClass('me-auto');
        $('.dt-search').prepend(AddButton);
        $('.dt-search').parent().css({ 'padding': '0' });
        $('.dt-length').append(FilterButton);
        $('.dt-length').parent().css({ 'padding': '0' });


        //Insert Project
        $("#addBtn").click(function () {
            var selectedSkills = $('#choices-multiple-remove-button').val();
            var skillString = selectedSkills.join(',');
            var projectval = {
                projectName: $("#Project_Name").val(),
                startdate: $("#start_date").val(),
                enddate: $("#end_date").val(),
                departmentid: $('#single').val(),
                skillid: skillString

            };
            console.log(projectName);

            $.ajax({
                url: '/Home/insertProject',
                data: projectval,
                type: 'POST',
                success: function (result) {

                    location.reload();
                    $('#examplemodal').modal('hide');
                },
                error: function (errormessage) {
                    alert(errormessage.responseText);
                }
            });
        });


        //Edit Buttton click
        $('#example').on('click', '.editbtn', function () {

            var row = $(this).closest('tr');
            var projectId = row.find('td:eq(0)').text(); // Get the project ID from data attribute

            $.ajax({
                url: '/Home/GetDepartmentByProjectId',
                type: 'POST',
                data: { projectId: projectId },
                success: function (result) {
                    console.log(result);

                    $('#Editmodal').modal('show');
                    var departmentId = result.departmentId;

                    //project value
                    $('#projectId').val(row.find('td:eq(0)').text());
                    $('#projectName').val(row.find('td:eq(1)').text());
                    var statusText = row.find('td:eq(2)').text();

                    //single dropdown status value
                    $('#statusSelect1 option').each(function () {
                        if ($(this).text() === statusText) {
                            $(this).prop('selected', true); // Select the option with matching text
                            return false; // Exit the loop once the option is selected
                        }
                    });

                    //single dropdown department value
                    $('#single2').find('option[value="' + departmentId + '"]').attr('selected', 'selected');


                    var formattedStartDate = formatDate(result.startDate);
                    var formattedEndDate = formatDate(result.endDate);


                    $('#startDate1').val(formattedStartDate); // Set start date in input field
                    $('#endDate1').val(formattedEndDate);// Set the value of the department in the dropdown




                    //multiple dropdown skills
                    var skillIdString = result.skillid; // Assuming skillIdString is a string containing comma-separated skill IDs
                    var skillIds = skillIdString.split(',').map(function (item) {
                        return parseInt(item.trim(), 10);
                    });

                    // Loop through each option in the dropdown
                    skillIds.forEach(function (skillId) {
                        $('#choices-multiple-remove-button').append($('<option></option>').attr('value', item.skillId).text('hello'));
                    });





                },
                error: function (err) {
                    alert('Error fetching department: ' + err.responseText);
                }
            });
        });

        //format date function
        function formatDate(dateString) {
            var dateParts = dateString.split("-");
            var formattedDate = dateParts[2] + "-" + dateParts[1] + "-" + dateParts[0]; // Reorder parts as dd-mm-yyyy
            return formattedDate;
        }


    });

    function Delete(projectId) {
        console.log(projectId);

        $('#deleteModal').modal('show');

        $('#confirmInput').on('input', function () {
            var confirmValue = $(this).val();

            if (confirmValue.trim().toUpperCase() === "CONFIRM") {
                $("#deleteButton").removeAttr("disabled");
                $("#deleteButton").addClass('btn-danger');
            } else {
                $("#deleteButton").attr("disabled", "disabled");
                $("#deleteButton").removeClass('btn-danger');
            }
        });

        $('#deleteButton').click(function () {
            var confirmValue = $('#confirmInput').val().trim().toUpperCase();

            if (confirmValue === "CONFIRM") {
                $.ajax({
                    url: "/Home/projectDelete",
                    type: 'POST',
                    data: {
                        projectId: projectId
                    },
                    success: function (result) {
                        window.location.reload();
                    },
                    error: function (errorMessage) {
                        alert('Error deleting project.');
                    }
                });
            }
        });

    }
</script>
